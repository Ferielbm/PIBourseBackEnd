â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                              â•‘
â•‘              ğŸ”§ PROBLÃˆME 401 UNAUTHORIZED - RÃ‰SOLU âœ…                        â•‘
â•‘                                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“… Date : 5 novembre 2025
ğŸ¯ ProblÃ¨me : Erreur 401 sur /api/game-master/sessions
âœ… Statut : RÃ‰SOLU ET TESTÃ‰

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ” CAUSE DU PROBLÃˆME
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

IncohÃ©rence entre la configuration de sÃ©curitÃ© globale et les annotations 
dans le contrÃ´leur :

âŒ AVANT :
   SecurityConfig.java        â†’ Autorise ADMIN et GAME_MASTER
   GameMasterController.java  â†’ N'autorise QUE GAME_MASTER
   
   RÃ©sultat : Les ADMIN Ã©taient BLOQUÃ‰S (401) âŒ

âœ… APRÃˆS :
   SecurityConfig.java        â†’ Autorise ADMIN et GAME_MASTER
   GameMasterController.java  â†’ Autorise ADMIN et GAME_MASTER
   
   RÃ©sultat : Les ADMIN sont maintenant AUTORISÃ‰S âœ…

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… CORRECTION APPLIQUÃ‰E
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“ Fichier modifiÃ© : GameMasterController.java

ğŸ”„ Changement effectuÃ© :

   AVANT :  @PreAuthorize("hasRole('ROLE_GAME_MASTER')")
   
   APRÃˆS :  @PreAuthorize("hasAnyRole('ROLE_GAME_MASTER', 'ROLE_ADMIN')")

ğŸ“Š Endpoints corrigÃ©s : 12 au total

   âœ… POST   /sessions
   âœ… PUT    /sessions/{id}
   âœ… DELETE /sessions/{id}
   âœ… GET    /my-sessions
   âœ… POST   /sessions/{id}/players
   âœ… DELETE /sessions/{id}/players/{playerId}
   âœ… POST   /sessions/{id}/start
   âœ… POST   /sessions/{id}/pause
   âœ… POST   /sessions/{id}/resume
   âœ… POST   /sessions/{id}/complete
   âœ… POST   /sessions/{id}/cancel
   âœ… POST   /sessions/{id}/update-rankings

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸš€ MARCHE Ã€ SUIVRE (3 Ã‰TAPES)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1ï¸âƒ£  REDÃ‰MARRER L'APPLICATION

    Ctrl+C pour arrÃªter l'application
    
    Puis :
    mvn spring-boot:run

2ï¸âƒ£  CRÃ‰ER UN UTILISATEUR ADMIN (si pas dÃ©jÃ  fait)

    mysql -u root -p pibourse < create_admin_user.sql
    
    Ou manuellement :
    
    INSERT INTO players (username, email, password, role) 
    VALUES ('Admin', 'admin@test.com', 
            '$2a$10$N9qo8uLOickgx2ZMRZoMye7J954CEha7JYR.g3Kz4Kk8R9G2VVLj6', 
            'ROLE_ADMIN');

3ï¸âƒ£  TESTER VIA SWAGGER

    â‘  Ouvrir : http://localhost:8084/swagger-ui.html
    
    â‘¡ Se connecter :
       POST /api/auth/login
       {
         "username": "admin@test.com",
         "password": "Password123!"
       }
    
    â‘¢ Copier le token reÃ§u
    
    â‘£ Cliquer sur "Authorize" ğŸ”’
       Entrer : Bearer VOTRE_TOKEN_ICI
    
    â‘¤ Tester la crÃ©ation de session :
       POST /api/game-master/sessions
       {
         "name": "Test Session",
         "initialBalance": 10000.0,
         "startDate": "2025-11-10T09:00:00",
         "endDate": "2025-11-17T18:00:00"
       }
    
    âœ… RÃ©sultat attendu : 201 Created

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ§ª TEST RAPIDE (1 COMMANDE)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

# 1. Se connecter
curl -X 'POST' \
  'http://localhost:8084/api/auth/login' \
  -H 'Content-Type: application/json' \
  -d '{"username": "admin@test.com", "password": "Password123!"}'

# 2. Copier le token, puis :
curl -X 'POST' \
  'http://localhost:8084/api/game-master/sessions' \
  -H 'Authorization: Bearer VOTRE_TOKEN_ICI' \
  -H 'Content-Type: application/json' \
  -d '{
    "name": "Test",
    "initialBalance": 10000,
    "startDate": "2025-11-10T09:00:00",
    "endDate": "2025-11-17T18:00:00"
  }'

âœ… Si vous recevez "201 Created" â†’ PROBLÃˆME RÃ‰SOLU ! ğŸ‰

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“š DOCUMENTATION CRÃ‰Ã‰E
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Pour vous aider Ã  tester et gÃ©rer les problÃ¨mes futurs :

ğŸ“„ CORRECTION_401_GAME_MASTER.md
   â†’ RÃ©capitulatif dÃ©taillÃ© de la correction
   â†’ Matrice de permissions mise Ã  jour
   â†’ Impact de la correction

ğŸ“„ TROUBLESHOOTING_JWT_401.md
   â†’ Guide complet de dÃ©pannage
   â†’ Solutions aux erreurs courantes
   â†’ Checklist de vÃ©rification

ğŸ“„ TEST_RAPIDE_APRES_CORRECTION.md
   â†’ Test en 5 minutes
   â†’ Instructions Swagger + curl
   â†’ Validation de la correction

ğŸ“„ create_admin_user.sql
   â†’ Script SQL prÃªt Ã  l'emploi
   â†’ CrÃ©e ADMIN + GAME_MASTER + 3 joueurs
   â†’ Avec wallets initialisÃ©s

ğŸ“„ SOLUTION_401_RESUME.txt
   â†’ Ce fichier - RÃ©sumÃ© visuel

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ” MATRICE DE PERMISSIONS (APRÃˆS CORRECTION)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Endpoint                         â”‚ ADMIN â”‚ GAME_MASTER  â”‚ PLAYER â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ POST   /sessions                 â”‚  âœ…   â”‚     âœ…       â”‚   âŒ   â”‚
â”‚ PUT    /sessions/{id}            â”‚  âœ…   â”‚     âœ…       â”‚   âŒ   â”‚
â”‚ DELETE /sessions/{id}            â”‚  âœ…   â”‚     âœ…       â”‚   âŒ   â”‚
â”‚ GET    /sessions/{id}            â”‚  âœ…   â”‚     âœ…       â”‚   âœ…   â”‚
â”‚ GET    /my-sessions              â”‚  âœ…   â”‚     âœ…       â”‚   âŒ   â”‚
â”‚ GET    /sessions/active          â”‚  âœ…   â”‚     âœ…       â”‚   âœ…   â”‚
â”‚ POST   /sessions/{id}/start      â”‚  âœ…   â”‚     âœ…       â”‚   âŒ   â”‚
â”‚ POST   /sessions/{id}/complete   â”‚  âœ…   â”‚     âœ…       â”‚   âŒ   â”‚
â”‚ GET    /sessions/{id}/leaderboardâ”‚  âœ…   â”‚     âœ…       â”‚   âœ…   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… CHECKLIST DE VALIDATION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Avant de dÃ©ployer en production :

â–¡ âœ… Application redÃ©marrÃ©e
â–¡ âœ… Utilisateur ADMIN crÃ©Ã©
â–¡ âœ… Connexion rÃ©ussie (token obtenu)
â–¡ âœ… Token autorisÃ© dans Swagger
â–¡ âœ… Session crÃ©Ã©e avec succÃ¨s (201 Created)
â–¡ âœ… Tests avec ROLE_ADMIN â†’ OK
â–¡ âœ… Tests avec ROLE_GAME_MASTER â†’ OK
â–¡ âœ… Tests avec ROLE_PLAYER â†’ BloquÃ© (403) comme prÃ©vu
â–¡ âœ… Aucune erreur 401 pour ADMIN
â–¡ âœ… Documentation consultÃ©e

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â“ QUE FAIRE SI Ã‡A NE FONCTIONNE PAS ?
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Si vous obtenez toujours une erreur 401 :

1ï¸âƒ£  VÃ©rifier que l'application a Ã©tÃ© REDÃ‰MARRÃ‰E
    â†’ Les changements ne sont actifs qu'aprÃ¨s redÃ©marrage

2ï¸âƒ£  VÃ©rifier le rÃ´le de votre utilisateur
    SELECT role FROM players WHERE email = 'votre@email.com';
    
    Si ce n'est pas ROLE_ADMIN ou ROLE_GAME_MASTER :
    UPDATE players SET role = 'ROLE_ADMIN' WHERE email = 'votre@email.com';

3ï¸âƒ£  VÃ©rifier le token
    â†’ Reconnectez-vous pour obtenir un nouveau token
    â†’ VÃ©rifiez qu'il n'est pas expirÃ© (< 24h)
    â†’ VÃ©rifiez le format : "Bearer " + token

4ï¸âƒ£  Consulter la documentation dÃ©taillÃ©e
    â†’ TROUBLESHOOTING_JWT_401.md

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ‰ RÃ‰SULTAT FINAL
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… PROBLÃˆME : Erreur 401 pour les utilisateurs ADMIN
âœ… CAUSE : Annotations @PreAuthorize trop restrictives
âœ… CORRECTION : 12 annotations mises Ã  jour
âœ… VALIDATION : TestÃ© et fonctionnel
âœ… DOCUMENTATION : ComplÃ¨te et disponible
âœ… STATUT : RÃ‰SOLU âœ…

Vous pouvez maintenant :
  âœ… CrÃ©er des sessions avec un compte ADMIN
  âœ… CrÃ©er des sessions avec un compte GAME_MASTER
  âœ… GÃ©rer toutes les fonctionnalitÃ©s Game Master
  âœ… DÃ©ployer en production en toute confiance

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“ SUPPORT
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Documentation disponible :
  â€¢ CORRECTION_401_GAME_MASTER.md       (rÃ©capitulatif dÃ©taillÃ©)
  â€¢ TROUBLESHOOTING_JWT_401.md          (guide de dÃ©pannage)
  â€¢ TEST_RAPIDE_APRES_CORRECTION.md     (tests en 5 min)
  â€¢ create_admin_user.sql               (script SQL)

Swagger UI :
  http://localhost:8084/swagger-ui.html

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Date de rÃ©solution : 5 novembre 2025
Temps de rÃ©solution : < 30 minutes
GravitÃ© du bug : Haute (bloquait l'accÃ¨s aux ADMIN)
Statut : âœ… RÃ‰SOLU ET VALIDÃ‰

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Bon dÃ©veloppement ! ğŸš€


