### ============================================================
### MODULE GAME MASTER - TESTS API
### ============================================================
### Guide complet pour tester toutes les fonctionnalit√©s du module Game Master
### Base URL: http://localhost:8084
### ============================================================

### Variables globales
@baseUrl = http://localhost:8084
@gameMasterToken = YOUR_GAME_MASTER_TOKEN_HERE
@playerToken = YOUR_PLAYER_TOKEN_HERE
@sessionId = 1
@playerId = 2

### ============================================================
### üìù √âTAPE 0 : AUTHENTIFICATION
### ============================================================

### 0.1 - Connexion en tant que Game Master
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "username": "gamemaster@example.com",
  "password": "Password123!"
}

### R√©ponse attendue : 
### {
###   "token": "eyJhbGciOiJIUzUxMiJ9...",
###   "type": "Bearer",
###   "id": 1,
###   "username": "GameMaster1",
###   "email": "gamemaster@example.com",
###   "role": "ROLE_GAME_MASTER"
### }
### 
### ‚ö†Ô∏è Copiez le token re√ßu et remplacez YOUR_GAME_MASTER_TOKEN_HERE ci-dessus

###

### 0.2 - Connexion en tant que Joueur (pour tester les permissions)
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "username": "player@example.com",
  "password": "Password123!"
}

### ‚ö†Ô∏è Copiez le token re√ßu et remplacez YOUR_PLAYER_TOKEN_HERE ci-dessus

###

### ============================================================
### üéÆ SECTION 1 : GESTION DES SESSIONS
### ============================================================

### 1.1 - Cr√©er une nouvelle session
POST {{baseUrl}}/api/game-master/sessions
Authorization: Bearer {{gameMasterToken}}
Content-Type: application/json

{
  "name": "Comp√©tition Bourse Hiver 2025",
  "description": "Session de trading comp√©titive pour joueurs avanc√©s",
  "initialBalance": 10000.00,
  "currency": "USD",
  "startDate": "2025-11-10T09:00:00",
  "endDate": "2025-11-17T18:00:00",
  "maxPlayers": 10,
  "allowLateJoin": false
}

### R√©ponse attendue : 201 Created
### ‚ö†Ô∏è Notez l'ID de la session cr√©√©e et mettez-le dans @sessionId

###

### 1.2 - R√©cup√©rer une session par ID
GET {{baseUrl}}/api/game-master/sessions/{{sessionId}}
Authorization: Bearer {{gameMasterToken}}

### R√©ponse attendue : 200 OK

###

### 1.3 - R√©cup√©rer toutes mes sessions
GET {{baseUrl}}/api/game-master/my-sessions
Authorization: Bearer {{gameMasterToken}}

### R√©ponse attendue : 200 OK avec tableau de sessions

###

### 1.4 - R√©cup√©rer les sessions actives
GET {{baseUrl}}/api/game-master/sessions/active
Authorization: Bearer {{gameMasterToken}}

### R√©ponse attendue : 200 OK

###

### 1.5 - R√©cup√©rer les sessions √† venir
GET {{baseUrl}}/api/game-master/sessions/upcoming
Authorization: Bearer {{gameMasterToken}}

### R√©ponse attendue : 200 OK

###

### 1.6 - Modifier une session (avant d√©marrage)
PUT {{baseUrl}}/api/game-master/sessions/{{sessionId}}
Authorization: Bearer {{gameMasterToken}}
Content-Type: application/json

{
  "name": "Comp√©tition Bourse Hiver 2025 - Modifi√©e",
  "description": "Description mise √† jour",
  "maxPlayers": 15
}

### R√©ponse attendue : 200 OK

###

### ============================================================
### üë• SECTION 2 : GESTION DES JOUEURS
### ============================================================

### 2.1 - Ajouter un joueur √† la session
POST {{baseUrl}}/api/game-master/sessions/{{sessionId}}/players
Authorization: Bearer {{gameMasterToken}}
Content-Type: application/json

{
  "playerId": {{playerId}}
}

### R√©ponse attendue : 201 Created

###

### 2.2 - Ajouter un second joueur
POST {{baseUrl}}/api/game-master/sessions/{{sessionId}}/players
Authorization: Bearer {{gameMasterToken}}
Content-Type: application/json

{
  "playerId": 3
}

###

### 2.3 - R√©cup√©rer la liste des joueurs dans la session
GET {{baseUrl}}/api/game-master/sessions/{{sessionId}}/players
Authorization: Bearer {{gameMasterToken}}

### R√©ponse attendue : 200 OK avec liste des joueurs

###

### 2.4 - Retirer un joueur de la session (avant d√©marrage)
DELETE {{baseUrl}}/api/game-master/sessions/{{sessionId}}/players/3
Authorization: Bearer {{gameMasterToken}}

### R√©ponse attendue : 200 OK

###

### 2.5 - Tenter d'ajouter un joueur d√©j√† dans la session (devrait √©chouer)
POST {{baseUrl}}/api/game-master/sessions/{{sessionId}}/players
Authorization: Bearer {{gameMasterToken}}
Content-Type: application/json

{
  "playerId": {{playerId}}
}

### R√©ponse attendue : 400 Bad Request
### Message : "Le joueur est d√©j√† dans cette session"

###

### ============================================================
### üéØ SECTION 3 : CONTR√îLE DE SESSION
### ============================================================

### 3.1 - D√©marrer la session
POST {{baseUrl}}/api/game-master/sessions/{{sessionId}}/start
Authorization: Bearer {{gameMasterToken}}

### R√©ponse attendue : 200 OK
### Status change : CREATED ‚Üí ACTIVE

###

### 3.2 - Tenter d'ajouter un joueur apr√®s le d√©marrage (devrait √©chouer si allowLateJoin=false)
POST {{baseUrl}}/api/game-master/sessions/{{sessionId}}/players
Authorization: Bearer {{gameMasterToken}}
Content-Type: application/json

{
  "playerId": 4
}

### R√©ponse attendue : 400 Bad Request
### Message : "Impossible d'ajouter des joueurs √† cette session"

###

### 3.3 - Mettre la session en pause
POST {{baseUrl}}/api/game-master/sessions/{{sessionId}}/pause
Authorization: Bearer {{gameMasterToken}}

### R√©ponse attendue : 200 OK
### Status change : ACTIVE ‚Üí PAUSED

###

### 3.4 - Reprendre la session
POST {{baseUrl}}/api/game-master/sessions/{{sessionId}}/resume
Authorization: Bearer {{gameMasterToken}}

### R√©ponse attendue : 200 OK
### Status change : PAUSED ‚Üí ACTIVE

###

### 3.5 - Terminer la session
POST {{baseUrl}}/api/game-master/sessions/{{sessionId}}/complete
Authorization: Bearer {{gameMasterToken}}

### R√©ponse attendue : 200 OK
### Status change : ACTIVE ‚Üí COMPLETED

###

### 3.6 - Tenter de modifier une session termin√©e (devrait √©chouer)
PUT {{baseUrl}}/api/game-master/sessions/{{sessionId}}
Authorization: Bearer {{gameMasterToken}}
Content-Type: application/json

{
  "name": "Tentative de modification"
}

### R√©ponse attendue : 400 Bad Request

###

### ============================================================
### üìä SECTION 4 : STATISTIQUES ET CLASSEMENTS
### ============================================================

### 4.1 - R√©cup√©rer le classement de la session
GET {{baseUrl}}/api/game-master/sessions/{{sessionId}}/leaderboard
Authorization: Bearer {{gameMasterToken}}

### R√©ponse attendue : 200 OK avec classement des joueurs

###

### 4.2 - Mettre √† jour les classements manuellement
POST {{baseUrl}}/api/game-master/sessions/{{sessionId}}/update-rankings
Authorization: Bearer {{gameMasterToken}}

### R√©ponse attendue : 200 OK

###

### 4.3 - Consulter la performance d'un joueur sp√©cifique
GET {{baseUrl}}/api/game-master/sessions/{{sessionId}}/players/{{playerId}}/performance
Authorization: Bearer {{gameMasterToken}}

### R√©ponse attendue : 200 OK avec statistiques d√©taill√©es

###

### 4.4 - Consulter l'historique complet d'un joueur
GET {{baseUrl}}/api/game-master/players/{{playerId}}/history
Authorization: Bearer {{gameMasterToken}}

### R√©ponse attendue : 200 OK avec liste de toutes les sessions du joueur

###

### ============================================================
### üö´ SECTION 5 : TESTS DE S√âCURIT√â
### ============================================================

### 5.1 - Tenter de cr√©er une session sans authentification
POST {{baseUrl}}/api/game-master/sessions
Content-Type: application/json

{
  "name": "Session Non Autoris√©e",
  "initialBalance": 10000.00,
  "startDate": "2025-11-10T09:00:00",
  "endDate": "2025-11-17T18:00:00"
}

### R√©ponse attendue : 401 Unauthorized

###

### 5.2 - Tenter de cr√©er une session avec un r√¥le PLAYER
POST {{baseUrl}}/api/game-master/sessions
Authorization: Bearer {{playerToken}}
Content-Type: application/json

{
  "name": "Session par Joueur",
  "initialBalance": 10000.00,
  "startDate": "2025-11-10T09:00:00",
  "endDate": "2025-11-17T18:00:00"
}

### R√©ponse attendue : 403 Forbidden

###

### 5.3 - Tenter de modifier une session cr√©√©e par un autre Game Master
### (Cr√©ez d'abord une session avec un autre GM, puis tentez de la modifier)
PUT {{baseUrl}}/api/game-master/sessions/999
Authorization: Bearer {{gameMasterToken}}
Content-Type: application/json

{
  "name": "Tentative de piratage"
}

### R√©ponse attendue : 400 Bad Request ou 403 Forbidden
### Message : "Seul le Game Master de cette session peut effectuer cette op√©ration"

###

### ============================================================
### ‚úÖ SECTION 6 : VALIDATION DES DONN√âES
### ============================================================

### 6.1 - Cr√©er une session avec des donn√©es invalides (nom trop court)
POST {{baseUrl}}/api/game-master/sessions
Authorization: Bearer {{gameMasterToken}}
Content-Type: application/json

{
  "name": "Ab",
  "initialBalance": 10000.00,
  "startDate": "2025-11-10T09:00:00",
  "endDate": "2025-11-17T18:00:00"
}

### R√©ponse attendue : 400 Bad Request

###

### 6.2 - Cr√©er une session avec solde initial n√©gatif
POST {{baseUrl}}/api/game-master/sessions
Authorization: Bearer {{gameMasterToken}}
Content-Type: application/json

{
  "name": "Session Invalide",
  "initialBalance": -5000.00,
  "startDate": "2025-11-10T09:00:00",
  "endDate": "2025-11-17T18:00:00"
}

### R√©ponse attendue : 400 Bad Request

###

### 6.3 - Cr√©er une session avec date de fin avant date de d√©but
POST {{baseUrl}}/api/game-master/sessions
Authorization: Bearer {{gameMasterToken}}
Content-Type: application/json

{
  "name": "Session Dates Invalides",
  "initialBalance": 10000.00,
  "startDate": "2025-11-17T18:00:00",
  "endDate": "2025-11-10T09:00:00"
}

### R√©ponse attendue : 400 Bad Request
### Message : "La date de fin doit √™tre apr√®s la date de d√©but"

###

### ============================================================
### üóëÔ∏è SECTION 7 : SUPPRESSION
### ============================================================

### 7.1 - Cr√©er une session temporaire pour test de suppression
POST {{baseUrl}}/api/game-master/sessions
Authorization: Bearer {{gameMasterToken}}
Content-Type: application/json

{
  "name": "Session Temporaire",
  "description": "√Ä supprimer",
  "initialBalance": 5000.00,
  "currency": "USD",
  "startDate": "2025-12-01T09:00:00",
  "endDate": "2025-12-07T18:00:00",
  "maxPlayers": 5,
  "allowLateJoin": false
}

### ‚ö†Ô∏è Notez l'ID de cette session

###

### 7.2 - Supprimer la session (avant d√©marrage)
DELETE {{baseUrl}}/api/game-master/sessions/TEMP_SESSION_ID
Authorization: Bearer {{gameMasterToken}}

### R√©ponse attendue : 200 OK
### Message : "Session supprim√©e avec succ√®s"

###

### 7.3 - Tenter de supprimer une session d√©j√† d√©marr√©e (devrait √©chouer)
DELETE {{baseUrl}}/api/game-master/sessions/{{sessionId}}
Authorization: Bearer {{gameMasterToken}}

### R√©ponse attendue : 400 Bad Request
### Message : "Impossible de supprimer une session d√©j√† d√©marr√©e"

###

### ============================================================
### üîÑ SECTION 8 : ANNULATION DE SESSION
### ============================================================

### 8.1 - Cr√©er une session √† annuler
POST {{baseUrl}}/api/game-master/sessions
Authorization: Bearer {{gameMasterToken}}
Content-Type: application/json

{
  "name": "Session √† Annuler",
  "description": "Test d'annulation",
  "initialBalance": 10000.00,
  "currency": "USD",
  "startDate": "2025-12-10T09:00:00",
  "endDate": "2025-12-17T18:00:00"
}

### ‚ö†Ô∏è Notez l'ID

###

### 8.2 - Annuler la session
POST {{baseUrl}}/api/game-master/sessions/CANCEL_SESSION_ID/cancel
Authorization: Bearer {{gameMasterToken}}

### R√©ponse attendue : 200 OK
### Status : CANCELLED

###

### ============================================================
### üìã SECTION 9 : SC√âNARIO COMPLET
### ============================================================
### Ce sc√©nario teste le workflow complet d'une session de jeu

### 9.1 - Cr√©er une session compl√®te
POST {{baseUrl}}/api/game-master/sessions
Authorization: Bearer {{gameMasterToken}}
Content-Type: application/json

{
  "name": "üéÆ Championnat Trading Automne 2025",
  "description": "Comp√©tition de trading avec prix pour le top 3",
  "initialBalance": 50000.00,
  "currency": "USD",
  "startDate": "2025-11-20T09:00:00",
  "endDate": "2025-11-27T18:00:00",
  "maxPlayers": 20,
  "allowLateJoin": true
}

### R√©ponse : Notez l'ID dans @sessionId

###

### 9.2 - Ajouter plusieurs joueurs
POST {{baseUrl}}/api/game-master/sessions/{{sessionId}}/players
Authorization: Bearer {{gameMasterToken}}
Content-Type: application/json

{
  "playerId": 2
}

###

POST {{baseUrl}}/api/game-master/sessions/{{sessionId}}/players
Authorization: Bearer {{gameMasterToken}}
Content-Type: application/json

{
  "playerId": 3
}

###

POST {{baseUrl}}/api/game-master/sessions/{{sessionId}}/players
Authorization: Bearer {{gameMasterToken}}
Content-Type: application/json

{
  "playerId": 4
}

###

### 9.3 - V√©rifier la liste des joueurs
GET {{baseUrl}}/api/game-master/sessions/{{sessionId}}/players
Authorization: Bearer {{gameMasterToken}}

###

### 9.4 - D√©marrer la session
POST {{baseUrl}}/api/game-master/sessions/{{sessionId}}/start
Authorization: Bearer {{gameMasterToken}}

###

### 9.5 - Consulter le classement initial
GET {{baseUrl}}/api/game-master/sessions/{{sessionId}}/leaderboard
Authorization: Bearer {{gameMasterToken}}

###

### 9.6 - Mettre √† jour les classements
POST {{baseUrl}}/api/game-master/sessions/{{sessionId}}/update-rankings
Authorization: Bearer {{gameMasterToken}}

###

### 9.7 - Consulter le classement mis √† jour
GET {{baseUrl}}/api/game-master/sessions/{{sessionId}}/leaderboard
Authorization: Bearer {{gameMasterToken}}

###

### 9.8 - Terminer la session
POST {{baseUrl}}/api/game-master/sessions/{{sessionId}}/complete
Authorization: Bearer {{gameMasterToken}}

###

### 9.9 - Consulter le classement final
GET {{baseUrl}}/api/game-master/sessions/{{sessionId}}/leaderboard
Authorization: Bearer {{gameMasterToken}}

###

### ============================================================
### üìä FIN DES TESTS
### ============================================================
### 
### ‚úÖ Checklist de validation :
### ‚ñ° Cr√©ation de session r√©ussie
### ‚ñ° Ajout de joueurs fonctionnel
### ‚ñ° D√©marrage de session OK
### ‚ñ° Pause/Reprise fonctionnelles
### ‚ñ° Classement mis √† jour
### ‚ñ° Cl√¥ture de session OK
### ‚ñ° S√©curit√© valid√©e (401, 403)
### ‚ñ° Validations de donn√©es OK
### ‚ñ° Suppression/Annulation OK
### 
### ============================================================


